param(
    [string]$Url,
    [string]$CertPath
)

function Get-DataFromUrl {
    param(
        [string]$Url,
        [string]$CertPath
    )

    try {
        # Wczytaj certyfikat
        $cert = Get-PfxCertificate -FilePath $CertPath

        # Ustaw protokół TLS na 1.2 lub inny odpowiedni
        [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12

        # Wywołaj usługę REST z użyciem certyfikatu
        $response = Invoke-RestMethod -Uri $Url -Method Get -Certificate $cert

        # Wyświetl odpowiedź
        Write-Output "Odpowiedź z serwera: $($response | ConvertTo-Json)"
    }
    catch {
        # Obsługa błędów i wyświetlanie wiadomości o błędzie
        Write-Error "Błąd: $_"
    }
}

# Wywołaj funkcję z przekazanymi parametrami
Get-DataFromUrl -Url $Url -CertPath $CertPath






pem


function Get-CertificateFromPem {
    param(
        [string]$PemPath
    )

    $certContent = Get-Content -Path $PemPath -Raw
    $certContent = $certContent -replace '-{5}(BEGIN|END) CERTIFICATE-{5}', ''
    $certContent = [System.Convert]::FromBase64String($certContent)
    $cert = New-Object System.Security.Cryptography.X509Certificates.X509Certificate2 -ArgumentList @($certContent)

    return $cert
}




